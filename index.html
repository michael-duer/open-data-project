<!doctype html>
<html>
    <head>
        <title>Home</title>
        <link rel="stylesheet" type="text/css" href="/stylesheet.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
        <link rel="icon" type="image/png" href="./img/tram-head2.svg">

        <script src="https://d3js.org/d3.v4.min.js"></script>
        <!--<script src="/script.js"></script>-->
        
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    </head>
<body>
    <div class="header">
        <h1 id="title">Visualisierung der Fahrgastdaten von Bernmobil in den Jahren 2019/2020</h1> 
        
        <h2 id="subtitle">In Korrelation mit den Covid-19 Massnahmen</h2>
    </div>
    <!-- Background SVG not working
    <div class="background">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
            <path fill="#de2236" fill-opacity="1" d="M0,96L60,90.7C120,85,240,75,360,64C480,53,600,43,720,58.7C840,75,960,117,1080,122.7C1200,128,1320,96,1380,80L1440,64L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path>
        </svg>
    </div>
    -->
    <script>
    var january2019 = "./data/monthly-data/january2019.csv";
    var february2019 = "./data/monthly-data/february2019.csv";
    var march2019 = "./data/monthly-data/march2019.csv";
    var april2019 = "./data/monthly-data/april2019.csv";
    var may2019 = "./data/monthly-data/may2019.csv";
    var june2019 = "./data/monthly-data/june2019.csv";
    var july2019 = "./data/monthly-data/july2019.csv";
    var august2019 = "./data/monthly-data/august2019.csv";
    var september2019 = "./data/monthly-data/september2019.csv";
    var october2019 = "./data/monthly-data/october2019.csv";
    var november2019 = "./data/monthly-data/november2019.csv";
    var december2019 = "./data/monthly-data/december2019.csv";
    var year2019 = "./data/biweekly2019-2.csv";

    var january2020 = "./data/monthly-data/january2020.csv";
    var february2020 =  "./data/monthly-data/february2020.csv";
    var march2020 = "./data/monthly-data/march2020.csv";
    var april2020 = "./data/monthly-data/april2020.csv";
    var may2020 = "./data/monthly-data/may2020.csv";
    var june2020 = "./data/monthly-data/june2020.csv";
    var july2020 = "./data/monthly-data/july2020.csv";
    var august2020 = "./data/monthly-data/august2020.csv";
    var september2020 = "./data/monthly-data/september2020.csv";
    var october2020 = "./data/monthly-data/october2020.csv";
    var november2020 = "./data/monthly-data/november2020.csv";
    var december2020 = "./data/monthly-data/december2020.csv";
    var year2020 = "./data/biweekly2020.csv";

    function responsivefy(svg) {
  // container will be the DOM element
  // that the svg is appended to
  // we then measure the container
  // and find its aspect ratio
  const container = d3.select(svg.node().parentNode),
      width = parseInt(svg.style('width'), 10),
      height = parseInt(svg.style('height'), 10),
      aspect = width / height;
    
  // set viewBox attribute to the initial size
  // control scaling with preserveAspectRatio
  // resize svg on inital page load
  svg.attr('viewBox', function(d) {
      if (svg.node().id == "bar-chart") {
        return `0 0 ${width} ${height}` //-50
      } else {
        return `0 0 ${width} ${height}`}
    })
      .attr('preserveAspectRatio', 'xMinYMid')
      .call(resize);
 
  // add listener so the chart will be resized
  // when the window resizes
  d3.select(window).on(
      'resize.' + container.attr('id'), 
      resize
  );
 
  // this is the code that resizes the chart
  // it will be called on load
  // and in response to window resizes
  // gets the width of the container
  // and resizes the svg to fill it
  // while maintaining a consistent aspect ratio
  function resize() {
      const w = parseInt(container.style('width'));
      svg.attr('width', w);
      svg.attr('height', Math.round(w / aspect));
  }
}
    </script>

<!-- Tram chart-->
<div class="chart-container">
    <h1 id="chart-title"> Im Pandemiejahr 2020 wurden im Vergleich zum Vorjahr X% weniger Fahrten gemacht</h1>
    <svg id="chart" width="80%" height="700"></svg>
</div>

<script>
var tramChart = d3.select("#chart").call(responsivefy);
var xPos2019 = 180,
        xPos2020 = 180,
        yPos = 53;
    
    var wagonAmount2019 = 7,
        wagonAmount2020 = 5; 
//add year text
tramChart
    .append("text")
    .attr("id", "year-number")
    .attr("y", 73)
    .attr("x", 60)
    .attr("text-anchor", "start")
    .attr("fill", "#000")
    .style("font-size", "2rem")
    .text("2019");

tramChart
    .append("text")
    .attr("id", "year-number")
    .attr("y", 250)
    .attr("x", 60)
    .attr("text-anchor", "start")
    .attr("fill", "#4e4e4e")
    .style("font-size", "2rem")
    .text("2020");
//add last wagon of both years
tramChart
  .append("svg:image")
  .attr("xlink:href", "./img/tram-wagon-min.svg")
  .attr("class", "lastWagon2019")
  .attr("width", 150)
  .attr("height", 150)
  .attr("x", yPos -25)
  .attr("y",yPos);

//define for calculation later
var percentageCutOff = 10,
//take wagon width / 100 * the percentage amount + const to lineup with other wagon2019 
scaleLeft = ((150/100) * percentageCutOff) + 20;


tramChart
  .append("svg:image")
  .attr("xlink:href", "./img/tram-wagon-min.svg")
  .attr("id", "lastWagon2020")
  .attr("width", 150)
  .attr("height", 150)
  .attr("x", yPos - scaleLeft)
  .attr("y",yPos + 180);
//define x position of the wagons2020 and cut off percentage
  var xPosLastWagon2020 = parseInt(d3.select("#lastWagon2020").attr("x"));
  var xPosNewWagon2020 = xPosLastWagon2020 + 152;
  var restPercentage = document.querySelector('#lastWagon2020');
    restPercentage.style.setProperty('--percentage', percentageCutOff + '%');

function addWagon2019() {
    tramChart
    .append("svg:image")
    .attr("xlink:href", "./img/tram-wagon-min.svg")
    .attr("id", "wagon")
    .attr("width", 150)
    .attr("height", 150)
    .attr("x", xPos2019)
    .attr("y",yPos);

    xPos2019 = xPos2019 + 152;
}

function addWagon2020() {
    tramChart
    .append("svg:image")
    .attr("xlink:href", "./img/tram-wagon-min.svg")
    .attr("id", "wagon")
    .attr("width", 150)
    .attr("height", 150)
    .attr("x", xPosNewWagon2020)
    .attr("y",yPos + 180);

    xPosNewWagon2020 = xPosNewWagon2020 + 152;
}

for (i = 0; i < wagonAmount2019; i++) {
    addWagon2019();
    i++
}

for (i = 0; i < wagonAmount2020; i++) {
    addWagon2020();
    i++
}
//draw tram head
tramChart
  .append("svg:image")
  .attr("xlink:href", "./img/tram-head2.svg")
  .attr("id", "head")
  .attr("width", 190)
  .attr("height", 190)
  .attr("x", xPos2019 - 7)//+ 145)
  .attr("y",yPos -13);

tramChart
  .append("svg:image")
  .attr("xlink:href", "./img/tram-head2.svg")
  .attr("id", "head")
  .attr("width", 190)
  .attr("height", 190)
  .attr("x", xPosNewWagon2020 - 7)//+ 145)
  .attr("y",yPos + 167)//190);
  
  </script>

<!-- Barchart-->
<div class="bar-chart">
    <div class="bar-chart-title">
        <h1>Die folgende Grafik zeigt die Anzahl transportierter Personen in Bussen und Trams
            mit eingebautem Zähler. Somit ist dies kein Abbild der Gesamtzahlen, sondern ein vergleichbarer Ausschnitt.</h1>
    </div>
    <div class="bar-chart-container">
        <div class="svg-container">
            <svg id="bar-chart"></svg>
            <p id="source">Quelle: BERNMOBIL & Bundesamt für Gesundheit</p>
        </div>
    <div class="bttn-container">
        <h1 id="instruction">Wählen Sie einen Zeitraum</h1>
            <div class="bttn-box">
                <div class="month-bttn">
                    <button onclick="update(january2019,january2020, 'Januar', false)">Januar</button>
                    <button onclick="update(february2019,february2020, 'Februar', false)">Februar</button>
                    <button onclick="update(march2019,march2020, 'März', false)">März</button>
                    <button onclick="update(april2019,april2020, 'April', false)">April</button>
                    <button onclick="update(may2019,may2020, 'Mai', false)">Mai</button>
                    <button onclick="update(june2019,june2020, 'Juni', false)">Juni</button>
                    <button onclick="update(july2019,july2020, 'Juli', false)">Juli</button>
                    <button onclick="update(august2019,august2020, 'August', false)">August</button>
                    <button onclick="update(september2019,september2020, 'September', false)">September</button>
                    <button onclick="update(october2019,october2020, 'Oktober', false)">Oktober</button>
                    <button onclick="update(november2019,november2020, 'November', false)">November</button>
                    <button onclick="update(december2019,december2020, 'Dezember', false)">Dezember</button>
                </div>
                <div class="year-bttn">
                    <button onclick="updateYear(year2019, year2020, 'über das Ganze Jahr', true)">Gesamtjahresvergleich</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    //margin andersch berechne so wi heatmap
    var margin = { top: 200, right: 100, bottom: 200, left: 100 },
          width = 1600 - margin.left - margin.right,
          height = 900 - margin.top - margin.bottom;

    var barChart = d3.select("#bar-chart")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .call(responsivefy);

    //var margin = 200,
     //   width = barChart.attr("width") - margin,
      //  height = barChart.attr("height") - margin -100;

       var g = barChart.append("g")
               .attr("transform", "translate(" + 100 + "," + 100 + ")");

    //initialize X-axis
    var xScale = d3.scaleBand().range([0, width]).padding(0.4)
    var xAxis = barChart.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(" + 100 + "," + 600 + ")");

    xAxis = d3.axisBottom()
    .scale(xScale);

    //initialize Y-axis
    var yScale = d3.scaleLinear().range([height, 0]);
    var yAxis = barChart.append("g")
        .attr("class", "y axis");

    yAxis = d3.axisLeft(yScale);
    //add tooltip
    var tooltip = d3.select("body").append("div").attr("class", "toolTip");

    //add variable to change tooltip text accordingly
    var showBiweeklyData = false;

// function to update the chart with new data
function update(month2019, month2020, monthString, showBiweeklyData) {
    
    // Parse the Data
    d3.queue()
        .defer(d3.csv, month2019) //2019
        .defer(d3.csv, month2020) //2020
        .defer(d3.csv, "massnahmen.csv")
        .await(function(error, data2019, data2020, massnahmen) {
            if (error) throw error;   
    
    //parse date from csv data
    function parseDate(d) {
        var delimiter = d.split(".");
        var d1 = new Date(Number(delimiter[2]), Number(delimiter[1]) -1, Number(delimiter[0]));
        return d3.timeFormat("%d.%m")(d1)
        };
        
    var dateFromCsv = [];

    data2019.forEach(function(d) {
        d.date = parseDate(d.date);
        dateFromCsv.push(d.date);
        d.transported_people = +d.transported_people;
    });
    data2020.forEach(function(d) {
        d.date = parseDate(d.date);
        d.transported_people = +d.transported_people;
    });
    massnahmen.forEach(function(d) {
        d.date = parseDate(d.date);
        d.text = d.text;
    });

    // set axis domains
    xScale.domain(data2020.map(function(d) { return d.date; }));
  
    yScale.domain([0, d3.max(data2019, function(d) { return d.transported_people; })]);
     
    //update xAxis
    barChart.select(".x.axis")
        .transition()
        .duration(1000)
        .call(xAxis)
        .call(d3.axisBottom(xScale))
        .style("font-size","1.1rem");

    //Update yAxis
    barChart.select(".y.axis")
        .attr("transform", "translate(" + 100 + "," + 100 + ")")
        .transition()
        .duration(1000)
        .call(g => g.select(".domain")
            .style("opacity", 0))
        .call(d3.axisLeft(yScale).tickFormat(function(d){
            return d;
        })
        .ticks(10))
        .style("font-size","1rem");
        //delete y-axis
        

    //delete old title
    barChart.selectAll("#barChartTitle")
        .remove();

      //delete old bars
      g.selectAll(".bar")
            .transition()
            .duration(500)
            .attr("y", 500)
            .attr("height", 0)
            .remove();
 
        //delete old text
        g.selectAll("text")
            .remove();

        //delete textbox
        g.selectAll(".textBox")
            .transition()
            .duration(500)
            .attr("y", 800)
            .attr("height", 0)
            .remove();

        //delete old line from box to point
        g.selectAll("line")
            .remove();
        
        //delete polygon
        g.selectAll("polygon")
         //   .transition()
         //   .duration(500)
            .remove();

        //add charty title
        barChart.append("text")
        .attr("id", 'barChartTitle')
        .attr("transform", "translate(100,0)")
        .attr("x", 50)
        .attr("y", 50)
        .attr("font-size", "2.2rem")
        .text("Fahrgastzahlen" + " " + monthString)
        // update bars2019
       g
        .selectAll("bar2019")
        .data(data2019)
        .enter()
        .append("rect")
        /*
        .on("mouseover", function(d){
            tooltip
              .style("left", d3.event.pageX - 50 + "px")
              .style("top", d3.event.pageY - 70 + "px")
              .style("display", "inline-block")
              .html((d.date) + ".2019" + "<br>" + "<br>" + "Fahrgäste: " + (d.transported_people));
        })
    	.on("mouseout", function(d){ tooltip.style("display", "none");})
        
       */
        .on("mouseover", function(d){
            tooltip
              .style("left", d3.event.pageX - 50 + "px")
              .style("top", d3.event.pageY - 70 + "px")
              .style("display", "inline-block")
              .html(function(e){
                if(showBiweeklyData == true) {
                    return "2019" + "<br>" + "<br>" + "Fahrgäste: " + (d.transported_people);
                } else {
                    return (d.date) + ".2019" + "<br>" + "<br>" + "Fahrgäste: " + (d.transported_people);
                }
                })
            })
    	.on("mouseout", function(d){ tooltip.style("display", "none");})
        
        .attr("class", "bar")
        .attr("id", 'bar2019')
        .attr("y", height +350)
        .attr("x", function(d) { return xScale(d.date);})
        .attr("height", 0)
        .transition()
        .duration(1000)
        .attr("x", function(d) { return xScale(d.date); })
        .attr("y", function(d) { return yScale(d.transported_people); })
        .attr("width", xScale.bandwidth() -5)
        .attr("height", function(d) { return (height - yScale(d.transported_people)) + 350; });
    
        // update bars2020
        g
        .selectAll("bar2020")
        .data(data2020)
        .enter()
        .append("rect")
        /*
        .on("mouseover", function(d){
            tooltip
              .style("left", d3.event.pageX - 50 + "px")
              .style("top", d3.event.pageY - 70 + "px")
              .style("display", "inline-block")
              .html((d.date) + ".2020" + "<br>" + "<br>" + "Fahrgäste: " + (d.transported_people));
        })
    	.on("mouseout", function(d){ tooltip.style("display", "none");})
        */
        .on("mouseover", function(d){
            tooltip
              .style("left", d3.event.pageX - 50 + "px")
              .style("top", d3.event.pageY - 70 + "px")
              .style("display", "inline-block")
              .html(function(e){
                if(showBiweeklyData) {
                    console.log(showBiweeklyData)
                    return "2020" + "<br>" + "<br>" + "Fahrgäste: " + (d.transported_people);
                } else {
                    return (d.date) + ".2020" + "<br>" + "<br>" + "Fahrgäste: " + (d.transported_people);
                }
                })
            })
    	.on("mouseout", function(d){ tooltip.style("display", "none");})
        
        .attr("class", "bar")
        .attr("id", 'bar2020')
        .attr("y", height +350)
        .attr("x", function(d) { return xScale(d.date);})
        .attr("height", 0)
        .transition()
        .duration(1000)
        .attr("x", function(d) { return xScale(d.date) + 10; })
        .attr("y", function(d) { return yScale(d.transported_people); })
        .attr("width", xScale.bandwidth() -5)
        .attr("height", function(d) { return (height - yScale(d.transported_people)) + 350; });

        //add textfield
         g.selectAll("g")
         .data(massnahmen)
         .enter()
         .append("rect")
         .attr("class", "textBox")
         .attr("x", function(d) { 
             if (dateFromCsv.includes(d.date)) {
                switch(d.date){
                    case "25.02":
                        return xScale(d.date) -150;
                        break;
                    case "28.02":
                        return xScale(d.date) -85;
                        break;
                    case "05.03":
                        return xScale(d.date) -130; 
                        break;
                    case "13.03":
                        return xScale(d.date) -315;
                        break;
                    case "16.03":
                        return xScale(d.date) - 75;
                        break;
                    case "20.03":
                        return xScale(d.date) -5;
                        break;
                    case "27.04":
                        return xScale(d.date) -250;
                        break;
                    case "11.05":
                        return xScale(d.date) -180;
                        break;
                    case "06.06":
                        return xScale(d.date) -180;
                        break;
                    case "22.06":
                        return xScale(d.date) -180;
                        break;
                    case "06.07":
                        return xScale(d.date) -90;
                        break;
                    case "01.10":
                        return xScale(d.date) -50;
                        break;
                    case "19.10":
                        return xScale(d.date) -385;
                        break;
                    case "29.10":
                        return xScale(d.date) -395;
                        break;
                    case "02.11":
                        return xScale(d.date) -80;
                        break;
                    case "12.12":
                        return xScale(d.date) -200;
                        break;
                    case "22.12":
                        return xScale(d.date) -100;
                        break;
                    default:
                    return xScale(d.date) -40; 
                }
            } else {
                return 0;
            }})
         .attr("y", 900)
         .transition()
         .duration(500)
         .attr("y", 550)
         .attr("width", function(d) { 
            switch(d.date){
                    case "25.02":
                        return 200;
                        break;
                    case "28.02":
                        return 270;
                        break;
                    case "05.03":
                        return 165;
                        break;
                    case "13.03":
                        return 365;
                        break;
                    case "16.03":
                        return 241;
                        break;
                    case "20.03":
                        return 370;
                        break;
                    case "27.04":
                        return 495;
                        break;
                    case "11.05":
                        return 740;
                        break;
                    case "06.06":
                        return 620;
                        break;
                    case "22.06":
                        return 550;
                        break;
                    case "06.07":
                        return 410;
                        break;
                    case "01.10":
                        return 310;
                        break;
                    case "19.10":
                        return 420;
                        break;
                    case "29.10":
                        return 610;
                        break;
                    case "02.11":
                        return 635;
                        break;
                    case "12.12":
                        return 510;
                        break;
                    case "22.12":
                        return 630;
                        break;
                    default:
                        return 200; 
                    }})
         .attr("height", function(d) {
            if (dateFromCsv.includes(d.date)) {
                switch(d.row){
                    case "0":
                        return 60;
                        break;
                    case "1":
                        return 60 + 25;
                        break;
                    case "2":
                        return 60 + 50;
                        break;
                    case "3":
                        return 60 + 75;
                        break;
                    case "4":
                        return 60 + 100;
                        break;
                    case "5":
                        return 60 + 125;
                        break;
                    default:
                        return 0; }
            } else {
                return 0;
            }})
         .style('fill', "#ffffd9")
         .attr('stroke', '#100f');
        //add arrow pointing to date
         g.selectAll("g")
            .data(massnahmen)
            .enter()
            .append('polygon')
            .attr("points", 900 + ', ' + 900 + ', ' + 900 + ', ' + 900 + ', ' + 900 + ', ' + 900)
            .transition()
            .duration(500)
            .attr("points", function(d) { 
             if (dateFromCsv.includes(d.date)) {
                return ((xScale(d.date) - 5) + ', ' + 550 + ', '   //left point
                        + (xScale(d.date) + 35) +', ' + 550+ ', '   //right point
                        + (xScale(d.date) + 15) + ', ' + 520);      //top point 
            } else {
                return 0 + ', ' + 0 + ', ' + 0 + ', ' + 0 + ', ' + 0 + ', ' + 0;
            }})
            .style('fill', '#ffffd9')
            .style("stroke", '#100f');

        //add line to cover black stroke of text box
        g.selectAll("g")
            .data(massnahmen)
            .enter()
            .append("line")
            .attr("x1", 900)
            .attr("x2", 900)
            .attr("y1", 900)
            .attr("y2", 900)
            .transition()
            .duration(500)
            .attr("x1", function(d) { 
             if (dateFromCsv.includes(d.date)) {
                return xScale(d.date) - 3.5; 
            } else {
                return 0;
            }})
            .attr("x2", function(d) { 
             if (dateFromCsv.includes(d.date)) {
                return xScale(d.date) + 33.5;
            } else {
                return 0;
            }})
            .attr("y1", 550)
            .attr("y2", 550)
            .style('stroke', '#ffffd9')
            .style( 'stroke-width', '2px');
            
        //add textMassnahmen
        var textMassnahmen =  g.selectAll("g")
            .data(massnahmen)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("x", 900)
            .attr("y", 900)
            .transition()
            .duration(500)
            .attr("x", function(d) { 
             if (dateFromCsv.includes(d.date)) {
                switch(d.date){
                    case "25.02":
                        return xScale(d.date) -140;
                        break;
                    case "28.02":
                        return xScale(d.date) -80;
                        break;
                    case "05.03":
                        return xScale(d.date) -120; 
                        break;
                    case "13.03":
                        return xScale(d.date) -305;
                        break;
                    case "16.03":
                        return xScale(d.date) - 65;
                        break;
                    case "20.03":
                        return xScale(d.date) + 5;
                        break;
                    case "27.04":
                        return xScale(d.date) -240;
                        break;
                    case "11.05":
                        return xScale(d.date) -175;
                        break;
                    case "06.06":
                        return xScale(d.date) -170;
                        break;
                    case "22.06":
                        return xScale(d.date) -170;
                        break;
                    case "06.07":
                        return xScale(d.date) -80;
                        break;
                    case "01.10":
                        return xScale(d.date) -40;
                        break;
                    case "19.10":
                        return xScale(d.date) -375;
                        break;
                    case "29.10":
                        return xScale(d.date) -385;
                        break;
                    case "02.11":
                        return xScale(d.date) -70;
                        break;
                    case "12.12":
                        return xScale(d.date) -190;
                        break;
                    case "22.12":
                        return xScale(d.date) -90;
                        break;
                    default:
                    return xScale(d.date) -35; 
                }
            } else {
                return;
            }})
            .attr("y", function(d) {
                switch(d.row){
                    case "0":
                        return 575;
                        break;
                    case "1":
                        return 575 + 25;
                        break;
                    case "2":
                        return 575 + 50;
                        break;
                    case "3":
                        return 575 + 75;
                        break;
                    case "4":
                        return 575 + 100;
                        break;
                    case "5":
                        return 575 + 125;
                        break;
                    default:
                        return 575;
            }})
            .attr("dy", ".35em")
            .style("font-size", function(d){
                 if (d.date == 5.03) {
                    return "1.3rem";
                } if (d.date == 13.03) {
                    return "1.3rem";
                } if (d.date == 16.03) {
                    return "1.3rem";
                } if (d.date == 20.03) {
                    return "1.3rem";
                }else {
                return "1.7rem";
                }
            })
            .text(function(d) { 
             if (dateFromCsv.includes(d.date)) {
                 return d.text; 
            } else {
                return;
            }});
        
    })

    }
update(january2019,january2020, "Januar", false);


function updateYear(month2019, month2020, monthString, showBiweeklyData) {
    
    
    update(month2019,month2020, monthString, showBiweeklyData);
  
    d3.csv(month2019, function(data2019) {  

    //remove x axis ticks
    d3.selectAll(".x.axis .tick line").each(function(d) {
        this.remove();
    });
    d3.selectAll(".x.axis .tick").each(function(d) {
        this.remove();
    });

    //delete old text
    g.selectAll("text")
            .remove();

        //delete textbox
        g.selectAll(".textBox")
            .transition()
            .duration(500)
            .attr("y", 800)
            .attr("height", 0)
            .remove();

        //delete old line from box to point
        g.selectAll("line")
            .remove();
        
        //delete polygon
        g.selectAll("polygon")
            .remove();

    //add text with month
    var label = ["Januar", "Februar", "März", "April", "Mai",
                "Juni", "Juli", "August", "September", "Oktober", 
                "November", "Dezember"]

  g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 40)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-weight", 100)
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("Januar"); 

            g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 155)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-size", "30px")
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("Februar"); 

            g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 280)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-size", "30px")
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("März"); 

            g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 395)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-size", "30px")
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("April"); 

            g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 515)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-size", "30px")
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("Mai"); 

            g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 625)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-size", "30px")
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("Juni"); 

            g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 745)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-size", "30px")
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("Juli"); 

            g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 845)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-size", "30px")
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("August"); 

            g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 950)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-size", "30px")
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("September"); 

            g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 1075)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-size", "30px")
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("Oktober"); 

            g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 1180)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-size", "30px")
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("November"); 

            g.selectAll("g")
            .data(data2019)
            .enter()
            .append("text")
            .attr("class", "text")
            .attr("id", "monthLabel")
            .attr("x", 1300)
            .attr("y", 515)
            .attr("dy", ".35em")
            //.style("font-size", "30px")
            .style("font-size", "1.5rem")
            .style("opacity", 0)
            .transition()
            .duration(500)
            .style("opacity", 1)
            .text("Dezember");
    
    //add textfield
    g.selectAll("g")
         .data(data2019)
         .enter()
         .append("rect")
         .attr("class", "textBox")
         .attr("x", 900)
         .attr("y", 900)
         .transition()
         .duration(500)
         .attr("x", 270)
         .attr("y", 565)
         .attr("width", 900)
         .attr("height", 40)
         .style('fill', "#ffffd9")
         .attr('stroke', '#100f');
    //add text
    g.selectAll("g")
        .data(data2019)
        .enter()
        .append("text")
        .attr("class", "text")
        .attr("id", "monthLabel")
        .attr("x", 900)
        .attr("y", 900)
        .transition()
        .duration(500)
        .attr("x", 280)
        .attr("y", 585)
        .attr("dy", ".35em")
        .style("font-size", "1.7rem")
        .text("Ein Balken repräsentiert die Summe der Daten eines halben Monats (ca 2 Wochen)");
  
    //change tooltip
    
    });
    
}

//add legend
var VALUES = ["month2019", "month2020"]

var legend = barChart.selectAll(".legend")
    .data(VALUES)
    .enter()
    .append("g")

    legend.append("rect")
    .attr("fill", "#003E71")
    .attr("width", 30)
    .attr("height", 30)
    .attr("y", 25)
    .attr("x", 700);
    legend.append("rect")
    .attr("fill", "#1796D2")
    .attr("width", 30)
    .attr("height", 30)
    .attr("y", 25)
    .attr("x", 800);

    legend.append("text")
    .attr("class", "label")
    .attr("y", 45)
    .attr("x", 735)
    .attr("text-anchor", "start")
    .style("font-size","1.7rem")
    .text("2019");
    legend.append("text")
    .attr("class", "label")
    .attr("y", 45)
    .attr("x", 835)
    .attr("text-anchor", "start")
    .style("font-size","1.7rem")
    .text("2020");

</script>

<!-- Heatmap-->
<div id="heatmap-div">
    <h1>Die selben Daten als Heatmap nach Wochentagen und Monaten gegliedert</h1>
    <svg id="heatmap"></svg>
</div>

    <script>
      var margin = { top: 100, right: 0, bottom: 100, left: 30 },
          width = 910 - margin.left - margin.right,
          height = 350 - margin.top - margin.bottom,
          gridSize = Math.floor(width / 48) + 5,
          legendElementWidth = gridSize*3,
          buckets = 9,
          colors = ["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"], // alternatively colorbrewer.YlGnBu[9]
          days = ["Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"],
          months = ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez']


        d3.queue()
        .defer(d3.csv, "./data/heatmap2019.csv") //2019
        .defer(d3.csv, "./data/heatmap2020.csv") //2020
        .await(function(error, heatmap2019, heatmap2020) {
            if (error) throw error;  

        heatmap2019.forEach(function(d) {
          return {
            day: +d.day,
            hour: +d.hour,
            value: +d.value
          };
        })
          heatmap2020.forEach(function(d) {
          return {
            day: +d.day,
            hour: +d.hour,
            value: +d.value
          };
        })
          var colorScale = d3.scaleQuantile()
              .domain([0, d3.max(heatmap2019, function (d) { return d.value; })])
              .range(colors);

          var svg = d3.select("#heatmap")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .call(responsivefy)
              .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        //add year label
        d3.select("#heatmap")
            .append("text")
            .attr("class", "text")
            .attr("id", "year-label")
            .attr("y", 62)
            .attr("x", 170)
            .attr("fill", "#000E")
            .style("font-size", "2rem")
            .style("font-weight", "600")
            .text("2019");

        d3.select("#heatmap")
            .append("text")
            .attr("class", "text")
            .attr("id", "year-label")
            .attr("y", 62)
            .attr("x", 700)
            .attr("fill", "#000")
            .style("font-size", "2rem")
            .style("font-weight", "600")
            .text("2020");

          //draw heatmap 2019
          var dayLabels = svg.selectAll(".dayLabel2019")
              .data(days)
              .attr("class", "text")
              .enter().append("text")
                .text(function (d) { return d; })
                .attr("x", 25)
                .attr("y", function (d, i) { return (i * gridSize) + 5; })
                .style("text-anchor", "end")
                .attr("transform", "translate(-6," + gridSize / 1.5 + ")")
                .attr("class", function (d, i) { return ((i >= 0 && i <= 4) ? "dayLabel mono axis axis-workweek" : "dayLabel mono axis"); })
                .style("fill", "#000");

          var monthLabels = svg.selectAll(".monthLabel2019")
              .data(months)
              .attr("class", "text")
              .enter().append("text")
                .text(function(d) { return d; })
                .attr("x", function(d, i) { return (i * gridSize) + 35; })
                .attr("y", 0)
                .style("text-anchor", "middle")
                .attr("transform", "translate(" + gridSize / 2 + ", -6)")
                .attr("class", function(d, i) { return ((i >= 7 && i <= 16) ? "timeLabel mono axis axis-worktime" : "timeLabel mono axis"); })
                .style("fill", "#000");

          var heatMap = svg.selectAll(".month2019")
              .data(heatmap2019)
              .enter().append("rect")
              .attr("x", function(d) { return ((d.month) * gridSize) + 15; })
              .attr("y", function(d) { return ((d.day) * gridSize) +5; })
              .attr("rx", 4)
              .attr("ry", 4)
              .attr("class", "month bordered")
              .attr("id", "heatmap2019")
              .attr("width", gridSize)
              .attr("height", gridSize)
              .style("fill", colors[0]);

          heatMap.transition().duration(1000)
              .style("fill", function(d) { return colorScale(d.value); });

          heatMap.append("title").text(function(d) { return "Bevörderte Personen: " + d.value; });

          //draw heatmap 2020
          var dayLabels = svg.selectAll(".dayLabel2020")
              .data(days)
              .enter().append("text")
              .attr("class", "text")
                .text(function (d) { return d; })
                .attr("x", 540)
                .attr("y", function (d, i) { return (i * gridSize) + 5; })
                .style("text-anchor", "end")
                .attr("transform", "translate(-6," + gridSize / 1.5 + ")")
                .attr("class", function (d, i) { return ((i >= 0 && i <= 4) ? "dayLabel mono axis axis-workweek" : "dayLabel mono axis"); })
                .style("fill", "#000");

          var monthLabels = svg.selectAll(".monthLabel2020")
              .data(months)
              .enter().append("text")
                .attr("class", "text")
                .text(function(d) { return d; })
                .attr("x", function(d, i) { return (i * gridSize) + 550; })
                .attr("y", 0)
                .style("text-anchor", "middle")
                .attr("transform", "translate(" + gridSize / 2 + ", -6)")
                .attr("class", function(d, i) { return ((i >= 7 && i <= 16) ? "timeLabel mono axis axis-worktime" : "timeLabel mono axis"); })
                .style("fill", "#000");

          var heatMap = svg.selectAll(".month2020")
              .data(heatmap2020)
              .enter().append("rect")
              .attr("x", function(d) { return ((d.month) * gridSize) + 530; })
              .attr("y", function(d) { return ((d.day) * gridSize) + 5; })
              .attr("rx", 4)
              .attr("ry", 4)
              .attr("class", "month bordered")
              .attr("width", gridSize)
              .attr("height", gridSize)
              .style("fill", colors[0]);

          heatMap.transition().duration(1000)
              .style("fill", function(d) { return colorScale(d.value); });

          heatMap.append("title").text(function(d) { return "Bevörderte Personen: " + d.value; });

          //draw legend
          var legend = svg.selectAll(".legend")
              .data([0].concat(colorScale.quantiles()), function(d) { return d; })
              .enter().append("g")
              .attr("class", "legend");

          legend.append("rect")
            .attr("x", function(d, i) { return (legendElementWidth * i) + 130; })
            .attr("y", height + 50)
            .attr("width", legendElementWidth)
            .attr("height", gridSize / 2)
            .style("fill", function(d, i) { return colors[i]; });

          legend.append("text")
            .attr("class", "mono")
            .text(function(d) { return "≥ " + Math.round(d); })
            .attr("x", function(d, i) { return (legendElementWidth * i) + 132; })
            .attr("y", height + gridSize + 50)
            .style("fill", "#000");
      });
    </script>

<div id="cards-container">
    <div class="card">
        <div class="bestDay">
            <h1 class="card-title">Bester Tag</h1>
            <h1 class="card-year">2019</h1>
            <p>19. September:</p>
            <p>223'636 Personen</p>

            <h1 class="card-year">2020</h1>
            <p>14. Januar:</p>
            <p>110'648 Personen</p>
            <img src="./img/increase.svg" class="card-icon" alt="increasing graph" style="width: 10rem; margin-top: 6rem;">
        </div>
    </div>
    <div class="card">
        <div class="worstDay">
            <h1 class="card-title">Schlechtester Tag</h1>
            <h1 class="card-year">2019</h1>
            <p>16. Juni:</p>
            <p>17'430 Personen</p>

            <h1 class="card-year">2020</h1>
            <p>10. April:</p>
            <p>2'796 Personen</p>
            <img src="./img/decrease.svg" class="card-icon" alt="decreasing graph" style="width: 10rem; margin-top: 6rem;">
        </div>
    </div>
    <div class="card">
        <div class="dayAverage">
            <h1 class="card-title">Durchschnitt</h1>
            <h1 class="card-year">2019</h1>
            <p>95'261 Fahrgäste pro Tag</p>

            <h1 class="card-year">2020</h1>
            <p>50'957 Fahrgäste pro Tag</p>
            <img src="./img/group.svg" class="card-icon" alt="decreasing graph" style="width: 15rem; margin-top: 10rem;">
        </div>
    </div>
    <div class="card">
        <div class="totalPassenger">
            <h1 class="card-title">Fahrgäste Total</h1>
            <h1 class="card-year">2019</h1>
            <p>34'770'168 Personen</p>

            <h1 class="card-year">2020</h1>
            <p>18'650'133 Personen</p>
            <p>(-53.6%)</p>
            <img src="./img/population.svg" class="card-icon" alt="decreasing graph" style="width: 15rem; margin-top: 4rem;">
        </div>
    </div>
</div>

<!-- Footer -->
<div id="footer" class="footer">
    <div class="copyright">
      <p>Copyright 2021 Michael Dür
        <a id="mail-address" href="mailto:michael.duer@bluewin.ch">michael.duer@bluewin.ch <i class="fas fa-envelope"></i></a> 
      </p>
    </div>
    <div>
        <p>Diese Visualisierung entstand 2021 im Rahmen der Open Data-Veranstaltung an der Universität Bern. </p>
    </div>
    <div class="credits"> <p>Tram Icons erstellt von</p>
        <a href="https://www.freepik.com" title="Freepik">Freepik</a> und
        <a href="https://www.flaticon.com/de/autoren/icongeek26" title="Icongeek26">Icongeek26</a> <br>
        <p>Sonstige Icons</p>
        <a href="https://www.flaticon.com/authors/photo3idea-studio" title="photo3idea_studio">photo3idea_studio</a>
        <a href="https://www.flaticon.com/authors/smashicons" title="Smashicons">Smashicons</a>
        <a href="https://www.freepik.com" title="Freepik">Freepik</a> <br>
        from <a href="https://www.flaticon.com/de/" title="Flaticon">www.flaticon.com</a>
    </div>
    <div>
        <p>Bildquelle: BERNMOBIL</p>
    </div>
  </div>
</body>
</html>